? PATCHED.txt
Index: Makefile
===================================================================
RCS file: /cvsroot/nev2lkit/nev2lkit/Makefile,v
retrieving revision 1.63
diff -B -U4 -r1.63 Makefile
--- Makefile	1 Oct 2005 15:23:42 -0000	1.63
+++ Makefile	7 Jun 2006 20:57:42 -0000
@@ -1,7 +1,7 @@
 #############################################################################
 # Makefile for building: nev2lkit
-# Generated by qmake (1.07a) (Qt 3.3.4) on: Sat Oct  1 16:40:51 2005
+# Generated by qmake (1.07a) (Qt 3.3.4) on: Sat Jan 21 18:09:14 2006
 # Project:  nev2lkit.pro
 # Template: app
 # Command: $(QMAKE) -o Makefile nev2lkit.pro
 #############################################################################
@@ -11,20 +11,20 @@
 CC       = gcc
 CXX      = g++
 LEX      = flex
 YACC     = yacc
-CFLAGS   = -pipe -Wall -W -mtune=pentium-m -O3 -pipe  -DQT_NO_DEBUG -DQT_SHARED -DQT_TABLET_SUPPORT -DQT_THREAD_SUPPORT
-CXXFLAGS = -pipe -Wall -W -O2 -mcpu=i686 -pipe  -DQT_NO_DEBUG -DQT_SHARED -DQT_TABLET_SUPPORT -DQT_THREAD_SUPPORT
+CFLAGS   = -pipe -Wall -W -O2  -DQT_NO_DEBUG -DQT_SHARED -DQT_THREAD_SUPPORT
+CXXFLAGS = -pipe -Wall -W -O2  -DQT_NO_DEBUG -DQT_SHARED -DQT_THREAD_SUPPORT
 LEXFLAGS = 
 YACCFLAGS= -d
-INCPATH  = -I/usr/qt/3/mkspecs/linux-g++ -I. -Iinclude -I/usr/include/qwt -I$(QTDIR)/include -I.ui/ -Igui -I.moc/
+INCPATH  = -I/usr/share/qt3/mkspecs/default -I. -Iinclude -I/usr/include/qwt -I/usr/include/qt3 -I.ui/ -Igui -I.moc/
 LINK     = g++
 LFLAGS   = 
-LIBS     = $(SUBLIBS) -L$(QTDIR)/lib -L/usr/X11R6/lib -lqwt -lqt-mt -lXext -lX11 -lm
+LIBS     = $(SUBLIBS) -L/usr/share/qt3/lib -L/usr/X11R6/lib -lqwt -lqt-mt -lXext -lX11 -lm
 AR       = ar cqs
 RANLIB   = 
-MOC      = $(QTDIR)/bin/moc
-UIC      = $(QTDIR)/bin/uic
+MOC      = /usr/share/qt3/bin/moc
+UIC      = /usr/share/qt3/bin/uic
 QMAKE    = qmake
 TAR      = tar -cf
 GZIP     = gzip -9f
 COPY     = cp -f
@@ -138,9 +138,9 @@
 
 $(MOC): 
 	( cd $(QTDIR)/src/moc && $(MAKE) )
 
-Makefile: nev2lkit.pro  /usr/qt/3/mkspecs/linux-g++/qmake.conf /usr/qt/3/lib/libqt-mt.prl
+Makefile: nev2lkit.pro  /usr/share/qt3/mkspecs/default/qmake.conf /usr/share/qt3/lib/libqt-mt.prl
 	$(QMAKE) -o Makefile nev2lkit.pro
 qmake: 
 	@$(QMAKE) -o Makefile nev2lkit.pro
 
Index: nev2lkit.pro
===================================================================
RCS file: /cvsroot/nev2lkit/nev2lkit/nev2lkit.pro,v
retrieving revision 1.10
diff -B -U4 -r1.10 nev2lkit.pro
--- nev2lkit.pro	29 Sep 2005 10:00:13 -0000	1.10
+++ nev2lkit.pro	7 Jun 2006 20:57:42 -0000
@@ -1,60 +1,69 @@
-TEMPLATE	= app
-LANGUAGE	= C++
-
-CONFIG	+= qt warn_on release
-
-RC_FILE = icon_nev2lkit.rc
-
-win32:LIBS	+= -lqwt
-
-unix:LIBS	+= -lqwt
-
-mac:LIBS	+= -lqwt
-
-INCLUDEPATH	+= ./include
-
-unix:INCLUDEPATH	+= /usr/include/qwt
-
-HEADERS	+= include/Array.h \
-	include/ascii.h \
-	include/endianness.h \
-	include/KK.h \
-	include/KlustaKwik.h \
-	include/KlustaSave.h \
-	include/labview.h \
-	include/lib.h \
-	include/nev.h \
-	include/nev1.h \
-	include/nev1_1.h \
-	include/nev2.h \
-	include/nev2lkit.h \
-	include/pca.h \
-	include/surflab.h
-
-SOURCES	+= lib/ascii.cpp \
-	lib/endianness.cpp \
-	lib/KK.cpp \
-	lib/KlustaKwik.cpp \
-	lib/labview.cpp \
-	lib/lib.cpp \
-	src/main.cpp \
-	lib/nev.cpp \
-	lib/nev1.cpp \
-	lib/nev1_1.cpp \
-	lib/nev2.cpp \
-	lib/nev2lkit.cpp \
-	lib/pca.cpp \
-	lib/surflab.cpp
-
-FORMS	= gui/main_form.ui \
-	gui/about_form.ui
-
-IMAGES	= images/ibumh.png \
-	images/nev2lkit_logo.png \
-	images/Logo_Cortivis_s.jpg
-
-unix {
-  UI_DIR = .ui
-  MOC_DIR = .moc
-  OBJECTS_DIR = .obj
-}
+TEMPLATE	= app
+LANGUAGE	= C++
+
+CONFIG	+= qt warn_on release
+
+win32:LIBS	+= -lqwt
+
+unix:LIBS	+= -lqwt
+
+mac:LIBS	+= -lqwt
+
+INCLUDEPATH	+= ./include
+
+unix:INCLUDEPATH	+= /usr/include/qwt
+
+HEADERS	+= include/Array.h \
+	include/ascii.h \
+	include/endianness.h \
+	include/KK.h \
+	include/KlustaKwik.h \
+	include/KlustaSave.h \
+	include/labview.h \
+	include/lib.h \
+	include/nev.h \
+	include/nev1.h \
+	include/nev1_1.h \
+	include/nev2.h \
+	include/nev2lkit.h \
+	include/pca.h \
+	include/surflab.h
+
+SOURCES	+= lib/ascii.cpp \
+	lib/endianness.cpp \
+	lib/KK.cpp \
+	lib/KlustaKwik.cpp \
+	lib/labview.cpp \
+	lib/lib.cpp \
+	src/main.cpp \
+	lib/nev.cpp \
+	lib/nev1.cpp \
+	lib/nev1_1.cpp \
+	lib/nev2.cpp \
+	lib/nev2lkit.cpp \
+	lib/pca.cpp \
+	lib/surflab.cpp
+
+FORMS	= gui/main_form.ui \
+	gui/about_form.ui
+
+IMAGES	= images/ibumh.png \
+	images/nev2lkit_logo.png \
+	images/Logo_Cortivis_s.jpg
+
+RC_FILE = icon_nev2lkit.rc
+
+
+
+
+
+
+
+
+
+
+unix {
+  UI_DIR = .ui
+  MOC_DIR = .moc
+  OBJECTS_DIR = .obj
+}
Index: gui/main_form.ui
===================================================================
RCS file: /cvsroot/nev2lkit/nev2lkit/gui/main_form.ui,v
retrieving revision 1.9
diff -B -U4 -r1.9 main_form.ui
--- gui/main_form.ui	12 Oct 2004 21:13:41 -0000	1.9
+++ gui/main_form.ui	7 Jun 2006 20:57:43 -0000
@@ -1,946 +1,1212 @@
-<!DOCTYPE UI><UI version="3.2" stdsetdef="1">
-<class>main_form</class>
-<widget class="QMainWindow">
-    <property name="name">
-        <cstring>main_form</cstring>
-    </property>
-    <property name="geometry">
-        <rect>
-            <x>0</x>
-            <y>0</y>
-            <width>555</width>
-            <height>652</height>
-        </rect>
-    </property>
-    <property name="caption">
-        <string>main_form</string>
-    </property>
-    <property name="icon">
-        <pixmap>nev2lkit_logo.png</pixmap>
-    </property>
-    <widget class="QGroupBox">
-        <property name="name">
-            <cstring>groupBox1</cstring>
-        </property>
-        <property name="geometry">
-            <rect>
-                <x>10</x>
-                <y>260</y>
-                <width>530</width>
-                <height>320</height>
-            </rect>
-        </property>
-        <property name="title">
-            <string>Data plotting</string>
-        </property>
-        <widget class="QwtSlider">
-            <property name="name">
-                <cstring>qwtSlider1_2</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>490</x>
-                    <y>23</y>
-                    <width>20</width>
-                    <height>245</height>
-                </rect>
-            </property>
-            <property name="orientation">
-                <enum>Vertical</enum>
-            </property>
-            <property name="bgStyle">
-                <enum>BgSlot</enum>
-            </property>
-            <property name="toolTip" stdset="0">
-                <string>Low threshold</string>
-            </property>
-        </widget>
-        <widget class="QwtSlider">
-            <property name="name">
-                <cstring>qwtSlider1</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>20</x>
-                    <y>23</y>
-                    <width>20</width>
-                    <height>245</height>
-                </rect>
-            </property>
-            <property name="orientation">
-                <enum>Vertical</enum>
-            </property>
-            <property name="bgStyle">
-                <enum>BgSlot</enum>
-            </property>
-            <property name="toolTip" stdset="0">
-                <string>High threshold</string>
-            </property>
-        </widget>
-        <widget class="QwtPlot">
-            <property name="name">
-                <cstring>plot</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>50</x>
-                    <y>30</y>
-                    <width>430</width>
-                    <height>280</height>
-                </rect>
-            </property>
-            <property name="frameShape">
-                <enum>NoFrame</enum>
-            </property>
-            <property name="frameShadow">
-                <enum>Plain</enum>
-            </property>
-            <property name="margin">
-                <number>0</number>
-            </property>
-            <property name="midLineWidth">
-                <number>0</number>
-            </property>
-            <property name="xBottomAxis" stdset="0">
-                <bool>true</bool>
-            </property>
-            <property name="yLeftAxis" stdset="0">
-                <bool>true</bool>
-            </property>
-            <property name="yRightAxis" stdset="0">
-                <bool>false</bool>
-            </property>
-            <property name="title">
-                <string></string>
-            </property>
-        </widget>
-    </widget>
-    <widget class="QGroupBox">
-        <property name="name">
-            <cstring>groupBox3</cstring>
-        </property>
-        <property name="geometry">
-            <rect>
-                <x>10</x>
-                <y>140</y>
-                <width>530</width>
-                <height>110</height>
-            </rect>
-        </property>
-        <property name="title">
-            <string>Sorting</string>
-        </property>
-        <widget class="QSpinBox">
-            <property name="name">
-                <cstring>max_clusters</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>280</x>
-                    <y>70</y>
-                    <width>60</width>
-                    <height>20</height>
-                </rect>
-            </property>
-        </widget>
-        <widget class="QLabel">
-            <property name="name">
-                <cstring>textLabel1_5_2</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>190</x>
-                    <y>70</y>
-                    <width>80</width>
-                    <height>21</height>
-                </rect>
-            </property>
-            <property name="text">
-                <string>Max clusters</string>
-            </property>
-        </widget>
-        <widget class="QLabel">
-            <property name="name">
-                <cstring>textLabel1_5_2_2</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>360</x>
-                    <y>70</y>
-                    <width>80</width>
-                    <height>21</height>
-                </rect>
-            </property>
-            <property name="text">
-                <string>Penalty mix</string>
-            </property>
-        </widget>
-        <widget class="QSpinBox">
-            <property name="name">
-                <cstring>penalty_mix</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>440</x>
-                    <y>70</y>
-                    <width>60</width>
-                    <height>20</height>
-                </rect>
-            </property>
-            <property name="lineStep">
-                <number>1</number>
-            </property>
-        </widget>
-        <widget class="QPushButton">
-            <property name="name">
-                <cstring>sort_all_button</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>430</x>
-                    <y>20</y>
-                    <width>71</width>
-                    <height>30</height>
-                </rect>
-            </property>
-            <property name="text">
-                <string>Sort all</string>
-            </property>
-        </widget>
-        <widget class="QPushButton">
-            <property name="name">
-                <cstring>sort_button</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>350</x>
-                    <y>20</y>
-                    <width>70</width>
-                    <height>30</height>
-                </rect>
-            </property>
-            <property name="text">
-                <string>Sort</string>
-            </property>
-        </widget>
-        <widget class="QLabel">
-            <property name="name">
-                <cstring>textLabel1_5</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>20</x>
-                    <y>70</y>
-                    <width>80</width>
-                    <height>21</height>
-                </rect>
-            </property>
-            <property name="text">
-                <string>Min clusters</string>
-            </property>
-        </widget>
-        <widget class="QSpinBox">
-            <property name="name">
-                <cstring>min_clusters</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>100</x>
-                    <y>70</y>
-                    <width>60</width>
-                    <height>20</height>
-                </rect>
-            </property>
-        </widget>
-        <widget class="QComboBox">
-            <item>
-                <property name="text">
-                    <string>Correlations</string>
-                </property>
-            </item>
-            <item>
-                <property name="text">
-                    <string>Variances-Covariances</string>
-                </property>
-            </item>
-            <item>
-                <property name="text">
-                    <string>Sums-Of-Squares-Cross-Products</string>
-                </property>
-            </item>
-            <property name="name">
-                <cstring>pca_method</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>110</x>
-                    <y>30</y>
-                    <width>210</width>
-                    <height>21</height>
-                </rect>
-            </property>
-        </widget>
-        <widget class="QLabel">
-            <property name="name">
-                <cstring>textLabel1_4</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>20</x>
-                    <y>30</y>
-                    <width>80</width>
-                    <height>21</height>
-                </rect>
-            </property>
-            <property name="text">
-                <string>PCA method</string>
-            </property>
-        </widget>
-    </widget>
-    <widget class="QGroupBox">
-        <property name="name">
-            <cstring>groupBox2</cstring>
-        </property>
-        <property name="geometry">
-            <rect>
-                <x>10</x>
-                <y>10</y>
-                <width>530</width>
-                <height>50</height>
-            </rect>
-        </property>
-        <property name="title">
-            <string>Configuration</string>
-        </property>
-        <widget class="QLabel">
-            <property name="name">
-                <cstring>textLabel1_2</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>20</x>
-                    <y>20</y>
-                    <width>60</width>
-                    <height>21</height>
-                </rect>
-            </property>
-            <property name="text">
-                <string>Channel</string>
-            </property>
-        </widget>
-        <widget class="QLabel">
-            <property name="name">
-                <cstring>textLabel1_3_3</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>310</x>
-                    <y>20</y>
-                    <width>30</width>
-                    <height>21</height>
-                </rect>
-            </property>
-            <property name="text">
-                <string>Unit</string>
-            </property>
-        </widget>
-        <widget class="QComboBox">
-            <item>
-                <property name="text">
-                    <string>All</string>
-                </property>
-            </item>
-            <property name="name">
-                <cstring>unit_select</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>340</x>
-                    <y>20</y>
-                    <width>70</width>
-                    <height>21</height>
-                </rect>
-            </property>
-        </widget>
-        <widget class="QLabel">
-            <property name="name">
-                <cstring>eventsLabel</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>430</x>
-                    <y>20</y>
-                    <width>90</width>
-                    <height>20</height>
-                </rect>
-            </property>
-            <property name="text">
-                <string>Events: 0</string>
-            </property>
-        </widget>
-        <widget class="QComboBox">
-            <item>
-                <property name="text">
-                    <string>1.0</string>
-                </property>
-            </item>
-            <item>
-                <property name="text">
-                    <string>1.6</string>
-                </property>
-            </item>
-            <item>
-                <property name="text">
-                    <string>2.0</string>
-                </property>
-            </item>
-            <item>
-                <property name="text">
-                    <string>4.0</string>
-                </property>
-            </item>
-            <property name="name">
-                <cstring>timeBox</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>240</x>
-                    <y>20</y>
-                    <width>50</width>
-                    <height>21</height>
-                </rect>
-            </property>
-            <property name="editable">
-                <bool>false</bool>
-            </property>
-            <property name="currentItem">
-                <number>0</number>
-            </property>
-            <property name="duplicatesEnabled">
-                <bool>false</bool>
-            </property>
-        </widget>
-        <widget class="QLabel">
-            <property name="name">
-                <cstring>textLabel1</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>200</x>
-                    <y>20</y>
-                    <width>40</width>
-                    <height>21</height>
-                </rect>
-            </property>
-            <property name="text">
-                <string>Time</string>
-            </property>
-        </widget>
-        <widget class="QComboBox">
-            <item>
-                <property name="text">
-                    <string>None</string>
-                </property>
-            </item>
-            <property name="name">
-                <cstring>channelSelect</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>80</x>
-                    <y>20</y>
-                    <width>100</width>
-                    <height>20</height>
-                </rect>
-            </property>
-            <property name="duplicatesEnabled">
-                <bool>false</bool>
-            </property>
-        </widget>
-    </widget>
-    <widget class="QGroupBox">
-        <property name="name">
-            <cstring>exportBox</cstring>
-        </property>
-        <property name="geometry">
-            <rect>
-                <x>10</x>
-                <y>65</y>
-                <width>531</width>
-                <height>70</height>
-            </rect>
-        </property>
-        <property name="title">
-            <string>Export format</string>
-        </property>
-        <widget class="QComboBox">
-            <item>
-                <property name="text">
-                    <string>Extended</string>
-                </property>
-            </item>
-            <item>
-                <property name="text">
-                    <string>Short</string>
-                </property>
-            </item>
-            <item>
-                <property name="text">
-                    <string>Short with waveform</string>
-                </property>
-            </item>
-            <property name="name">
-                <cstring>export_format</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>110</x>
-                    <y>30</y>
-                    <width>160</width>
-                    <height>21</height>
-                </rect>
-            </property>
-        </widget>
-        <widget class="QLabel">
-            <property name="name">
-                <cstring>textLabel1_3_2</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>20</x>
-                    <y>30</y>
-                    <width>80</width>
-                    <height>21</height>
-                </rect>
-            </property>
-            <property name="text">
-                <string>ASCII format</string>
-            </property>
-        </widget>
-        <widget class="QPushButton">
-            <property name="name">
-                <cstring>export_as_ascii</cstring>
-            </property>
-            <property name="geometry">
-                <rect>
-                    <x>360</x>
-                    <y>20</y>
-                    <width>140</width>
-                    <height>30</height>
-                </rect>
-            </property>
-            <property name="text">
-                <string>Export as ASCII</string>
-            </property>
-        </widget>
-    </widget>
-</widget>
-<menubar>
-    <property name="name">
-        <cstring>MenuBar</cstring>
-    </property>
-    <property name="geometry">
-        <rect>
-            <x>0</x>
-            <y>0</y>
-            <width>555</width>
-            <height>33</height>
-        </rect>
-    </property>
-    <item text="&amp;File" name="fileMenu">
-        <action name="fileOpenAction"/>
-        <action name="fileExport_as_NEVAction"/>
-        <action name="fileCloseAction"/>
-        <separator/>
-        <action name="fileOpen_a_directoryAction"/>
-        <action name="fileSort_a_directoryAction"/>
-        <separator/>
-        <action name="filePrintAction"/>
-        <separator/>
-        <action name="fileExitAction"/>
-    </item>
-    <item text="&amp;Help" name="helpMenu">
-        <action name="helpAboutAction"/>
-    </item>
-</menubar>
-<toolbars>
-</toolbars>
-<customwidgets>
-</customwidgets>
-<actions>
-    <action>
-        <property name="name">
-            <cstring>fileOpenAction</cstring>
-        </property>
-        <property name="iconSet">
-            <iconset></iconset>
-        </property>
-        <property name="text">
-            <string>&amp;Open file...</string>
-        </property>
-        <property name="menuText">
-            <string>&amp;Open file...</string>
-        </property>
-        <property name="toolTip">
-            <string>Open a file...</string>
-        </property>
-        <property name="accel">
-            <string>Ctrl+O</string>
-        </property>
-    </action>
-    <action>
-        <property name="name">
-            <cstring>fileExitAction</cstring>
-        </property>
-        <property name="text">
-            <string>&amp;Exit</string>
-        </property>
-        <property name="menuText">
-            <string>&amp;Exit</string>
-        </property>
-        <property name="toolTip">
-            <string>Exit</string>
-        </property>
-        <property name="accel">
-            <string></string>
-        </property>
-    </action>
-    <action>
-        <property name="name">
-            <cstring>helpAboutAction</cstring>
-        </property>
-        <property name="text">
-            <string>A&amp;bout</string>
-        </property>
-        <property name="menuText">
-            <string>A&amp;bout</string>
-        </property>
-        <property name="toolTip">
-            <string>About</string>
-        </property>
-        <property name="accel">
-            <string>F9</string>
-        </property>
-    </action>
-    <action>
-        <property name="name">
-            <cstring>fileExport_as_NEVAction</cstring>
-        </property>
-        <property name="enabled">
-            <bool>true</bool>
-        </property>
-        <property name="iconSet">
-            <iconset></iconset>
-        </property>
-        <property name="text">
-            <string>&amp;Save as NEV2...</string>
-        </property>
-        <property name="menuText">
-            <string>&amp;Save as NEV2...</string>
-        </property>
-        <property name="toolTip">
-            <string>Save as NEV2</string>
-        </property>
-        <property name="accel">
-            <string>Ctrl+S</string>
-        </property>
-    </action>
-    <action>
-        <property name="name">
-            <cstring>fileOpen_a_directoryAction</cstring>
-        </property>
-        <property name="iconSet">
-            <iconset></iconset>
-        </property>
-        <property name="text">
-            <string>Export &amp;directory...</string>
-        </property>
-        <property name="menuText">
-            <string>Export &amp;directory...</string>
-        </property>
-        <property name="toolTip">
-            <string>Export a directory...</string>
-        </property>
-        <property name="accel">
-            <string>Ctrl+D</string>
-        </property>
-    </action>
-    <action>
-        <property name="name">
-            <cstring>fileExport_as_ASCIIAction</cstring>
-        </property>
-        <property name="text">
-            <string>Export as &amp;ASCII...</string>
-        </property>
-        <property name="menuText">
-            <string>Export as &amp;ASCII...</string>
-        </property>
-        <property name="toolTip">
-            <string>Export as ASCII</string>
-        </property>
-        <property name="accel">
-            <string>Ctrl+A</string>
-        </property>
-    </action>
-    <action>
-        <property name="name">
-            <cstring>fileCloseAction</cstring>
-        </property>
-        <property name="text">
-            <string>&amp;Close</string>
-        </property>
-        <property name="menuText">
-            <string>&amp;Close</string>
-        </property>
-        <property name="toolTip">
-            <string>Close</string>
-        </property>
-        <property name="accel">
-            <string>Ctrl+W</string>
-        </property>
-    </action>
-    <action>
-        <property name="name">
-            <cstring>filePrintAction</cstring>
-        </property>
-        <property name="text">
-            <string>&amp;Print</string>
-        </property>
-        <property name="menuText">
-            <string>&amp;Print</string>
-        </property>
-        <property name="toolTip">
-            <string>Print</string>
-        </property>
-        <property name="accel">
-            <string>Ctrl+P</string>
-        </property>
-    </action>
-    <action>
-        <property name="name">
-            <cstring>Action</cstring>
-        </property>
-        <property name="iconSet">
-            <iconset></iconset>
-        </property>
-        <property name="text">
-            <string>Unnamed</string>
-        </property>
-        <property name="menuText">
-            <string>Unnamed</string>
-        </property>
-    </action>
-    <action>
-        <property name="name">
-            <cstring>fileSort_a_directoryAction</cstring>
-        </property>
-        <property name="text">
-            <string>Sort &amp;units in directory...</string>
-        </property>
-        <property name="menuText">
-            <string>Sort &amp;units in directory...</string>
-        </property>
-        <property name="toolTip">
-            <string>Sort units in directory</string>
-        </property>
-        <property name="accel">
-            <string>Ctrl+U</string>
-        </property>
-    </action>
-</actions>
-<connections>
-    <connection>
-        <sender>fileOpenAction</sender>
-        <signal>activated()</signal>
-        <receiver>main_form</receiver>
-        <slot>fileOpen()</slot>
-    </connection>
-    <connection>
-        <sender>helpAboutAction</sender>
-        <signal>activated()</signal>
-        <receiver>main_form</receiver>
-        <slot>helpAbout()</slot>
-    </connection>
-    <connection>
-        <sender>fileExitAction</sender>
-        <signal>activated()</signal>
-        <receiver>main_form</receiver>
-        <slot>fileExit()</slot>
-    </connection>
-    <connection>
-        <sender>qwtSlider1</sender>
-        <signal>valueChanged(double)</signal>
-        <receiver>main_form</receiver>
-        <slot>setHighThresold(double)</slot>
-    </connection>
-    <connection>
-        <sender>qwtSlider1_2</sender>
-        <signal>valueChanged(double)</signal>
-        <receiver>main_form</receiver>
-        <slot>setLowThresold(double)</slot>
-    </connection>
-    <connection>
-        <sender>timeBox</sender>
-        <signal>activated(const QString&amp;)</signal>
-        <receiver>main_form</receiver>
-        <slot>timeChanged(const QString&amp;)</slot>
-    </connection>
-    <connection>
-        <sender>qwtSlider1</sender>
-        <signal>sliderReleased()</signal>
-        <receiver>main_form</receiver>
-        <slot>replot()</slot>
-    </connection>
-    <connection>
-        <sender>qwtSlider1_2</sender>
-        <signal>sliderReleased()</signal>
-        <receiver>main_form</receiver>
-        <slot>replot()</slot>
-    </connection>
-    <connection>
-        <sender>fileOpen_a_directoryAction</sender>
-        <signal>activated()</signal>
-        <receiver>main_form</receiver>
-        <slot>fileExportDir()</slot>
-    </connection>
-    <connection>
-        <sender>fileCloseAction</sender>
-        <signal>activated()</signal>
-        <receiver>main_form</receiver>
-        <slot>closeFile()</slot>
-    </connection>
-    <connection>
-        <sender>fileExport_as_NEVAction</sender>
-        <signal>activated()</signal>
-        <receiver>main_form</receiver>
-        <slot>fileExportAsNEV()</slot>
-    </connection>
-    <connection>
-        <sender>fileExport_as_ASCIIAction</sender>
-        <signal>activated()</signal>
-        <receiver>main_form</receiver>
-        <slot>fileExportAsASCII()</slot>
-    </connection>
-    <connection>
-        <sender>filePrintAction</sender>
-        <signal>activated()</signal>
-        <receiver>main_form</receiver>
-        <slot>print()</slot>
-    </connection>
-    <connection>
-        <sender>unit_select</sender>
-        <signal>activated(const QString&amp;)</signal>
-        <receiver>main_form</receiver>
-        <slot>unitChanged(const QString&amp;)</slot>
-    </connection>
-    <connection>
-        <sender>sort_button</sender>
-        <signal>clicked()</signal>
-        <receiver>main_form</receiver>
-        <slot>reSort()</slot>
-    </connection>
-    <connection>
-        <sender>pca_method</sender>
-        <signal>activated(int)</signal>
-        <receiver>main_form</receiver>
-        <slot>sortMethodChanged(int)</slot>
-    </connection>
-    <connection>
-        <sender>sort_all_button</sender>
-        <signal>clicked()</signal>
-        <receiver>main_form</receiver>
-        <slot>sortAllChannels()</slot>
-    </connection>
-    <connection>
-        <sender>fileSort_a_directoryAction</sender>
-        <signal>activated()</signal>
-        <receiver>main_form</receiver>
-        <slot>fileSortDir()</slot>
-    </connection>
-    <connection>
-        <sender>min_clusters</sender>
-        <signal>valueChanged(int)</signal>
-        <receiver>main_form</receiver>
-        <slot>sortMethodChanged(int)</slot>
-    </connection>
-    <connection>
-        <sender>max_clusters</sender>
-        <signal>valueChanged(int)</signal>
-        <receiver>main_form</receiver>
-        <slot>sortMethodChanged(int)</slot>
-    </connection>
-    <connection>
-        <sender>penalty_mix</sender>
-        <signal>valueChanged(int)</signal>
-        <receiver>main_form</receiver>
-        <slot>sortMethodChanged(int)</slot>
-    </connection>
-    <connection>
-        <sender>channelSelect</sender>
-        <signal>activated(int)</signal>
-        <receiver>main_form</receiver>
-        <slot>channelChanged(int)</slot>
-    </connection>
-    <connection>
-        <sender>export_as_ascii</sender>
-        <signal>clicked()</signal>
-        <receiver>main_form</receiver>
-        <slot>fileExportAsASCII()</slot>
-    </connection>
-</connections>
-<includes>
-    <include location="global" impldecl="in declaration">qfiledialog.h</include>
-    <include location="global" impldecl="in declaration">qmessagebox.h</include>
-    <include location="local" impldecl="in implementation">main_form.ui.h</include>
-</includes>
-<variables>
-    <variable access="private">double *x;</variable>
-    <variable access="private">double **y;</variable>
-    <variable access="private">uchar *unit;</variable>
-    <variable access="private">long mHigh;</variable>
-    <variable access="private">long mLow;</variable>
-    <variable access="private">uint channel;</variable>
-    <variable access="private">uint events;</variable>
-    <variable access="private">long *data;</variable>
-    <variable access="private">bool *unitSelect;</variable>
-</variables>
-<slots>
-    <slot>init()</slot>
-    <slot>fileOpen()</slot>
-    <slot>fileExportAsNEV()</slot>
-    <slot>fileExportAsASCII()</slot>
-    <slot>closeFile()</slot>
-    <slot>fileExportDir()</slot>
-    <slot>fileSortDir()</slot>
-    <slot>fileExit()</slot>
-    <slot>helpAbout()</slot>
-    <slot>setHighThresold( double value )</slot>
-    <slot>setLowThresold( double value )</slot>
-    <slot>replot( const QString &amp; value )</slot>
-    <slot>timeChanged( const QString &amp; value )</slot>
-    <slot>channelChanged( int ch )</slot>
-    <slot>replot()</slot>
-    <slot>print()</slot>
-    <slot>unitChanged( const QString &amp; value )</slot>
-    <slot>addUnits()</slot>
-    <slot>reSort()</slot>
-    <slot returnType="uint">countEvents(uint, int)</slot>
-    <slot>setPlot()</slot>
-    <slot returnType="int">maxSpikes()</slot>
-    <slot returnType="bool">sortAllChannels()</slot>
-    <slot>sortMethodChanged( int value )</slot>
-    <slot>closeEvent(QCloseEvent *e)</slot>
-    <slot>displaySpikes()</slot>
-</slots>
-<functions>
-    <function access="private">resetData()</function>
-    <function access="private">resetPlot()</function>
-</functions>
-<pixmapinproject/>
-<layoutdefaults spacing="6" margin="11"/>
-<includehints>
-    <includehint>qwt_slider.h</includehint>
-    <includehint>qwt_plot.h</includehint>
-    <includehint>qwt_scale.h</includehint>
-</includehints>
-</UI>
+<!DOCTYPE UI><UI version="3.3" stdsetdef="1">
+<class>main_form</class>
+<widget class="QMainWindow">
+    <property name="name">
+        <cstring>main_form</cstring>
+    </property>
+    <property name="geometry">
+        <rect>
+            <x>0</x>
+            <y>0</y>
+            <width>560</width>
+            <height>659</height>
+        </rect>
+    </property>
+    <property name="caption">
+        <string>main_form</string>
+    </property>
+    <widget class="QGroupBox">
+        <property name="name">
+            <cstring>groupBox2</cstring>
+        </property>
+        <property name="geometry">
+            <rect>
+                <x>10</x>
+                <y>10</y>
+                <width>540</width>
+                <height>50</height>
+            </rect>
+        </property>
+        <property name="title">
+            <string>Configuration</string>
+        </property>
+        <widget class="QLabel">
+            <property name="name">
+                <cstring>textLabel1_2</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>10</x>
+                    <y>20</y>
+                    <width>64</width>
+                    <height>21</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="text">
+                <string>Channel</string>
+            </property>
+        </widget>
+        <widget class="QComboBox">
+            <item>
+                <property name="text">
+                    <string>None</string>
+                </property>
+            </item>
+            <property name="name">
+                <cstring>channelSelect</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>70</x>
+                    <y>20</y>
+                    <width>80</width>
+                    <height>20</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="duplicatesEnabled">
+                <bool>false</bool>
+            </property>
+        </widget>
+        <widget class="QLabel">
+            <property name="name">
+                <cstring>textLabel1</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>160</x>
+                    <y>20</y>
+                    <width>83</width>
+                    <height>21</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="text">
+                <string>Time Scale</string>
+            </property>
+        </widget>
+        <widget class="QComboBox">
+            <item>
+                <property name="text">
+                    <string>1.0</string>
+                </property>
+            </item>
+            <item>
+                <property name="text">
+                    <string>1.6</string>
+                </property>
+            </item>
+            <item>
+                <property name="text">
+                    <string>2.0</string>
+                </property>
+            </item>
+            <item>
+                <property name="text">
+                    <string>4.0</string>
+                </property>
+            </item>
+            <property name="name">
+                <cstring>timeBox</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>240</x>
+                    <y>20</y>
+                    <width>50</width>
+                    <height>21</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="editable">
+                <bool>false</bool>
+            </property>
+            <property name="currentItem">
+                <number>0</number>
+            </property>
+            <property name="duplicatesEnabled">
+                <bool>false</bool>
+            </property>
+        </widget>
+        <widget class="QLabel">
+            <property name="name">
+                <cstring>textLabel1_3_3</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>300</x>
+                    <y>20</y>
+                    <width>30</width>
+                    <height>21</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="text">
+                <string>Unit</string>
+            </property>
+        </widget>
+        <widget class="QComboBox">
+            <item>
+                <property name="text">
+                    <string>All</string>
+                </property>
+            </item>
+            <property name="name">
+                <cstring>unit_select</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>340</x>
+                    <y>20</y>
+                    <width>70</width>
+                    <height>21</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+        </widget>
+        <widget class="QLabel">
+            <property name="name">
+                <cstring>eventsLabel</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>420</x>
+                    <y>20</y>
+                    <width>110</width>
+                    <height>20</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="text">
+                <string>Events: 0</string>
+            </property>
+        </widget>
+    </widget>
+    <widget class="QGroupBox">
+        <property name="name">
+            <cstring>exportBox</cstring>
+        </property>
+        <property name="geometry">
+            <rect>
+                <x>10</x>
+                <y>60</y>
+                <width>540</width>
+                <height>70</height>
+            </rect>
+        </property>
+        <property name="title">
+            <string>Export format</string>
+        </property>
+        <widget class="QPushButton">
+            <property name="name">
+                <cstring>export_as_ascii</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>360</x>
+                    <y>20</y>
+                    <width>140</width>
+                    <height>30</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="text">
+                <string>Export as ASCII</string>
+            </property>
+        </widget>
+        <widget class="QLabel">
+            <property name="name">
+                <cstring>textLabel1_3_2</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>10</x>
+                    <y>30</y>
+                    <width>80</width>
+                    <height>21</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="text">
+                <string>ASCII format</string>
+            </property>
+        </widget>
+        <widget class="QComboBox">
+            <item>
+                <property name="text">
+                    <string>Extended</string>
+                </property>
+            </item>
+            <item>
+                <property name="text">
+                    <string>Short</string>
+                </property>
+            </item>
+            <item>
+                <property name="text">
+                    <string>Short with waveform</string>
+                </property>
+            </item>
+            <property name="name">
+                <cstring>export_format</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>100</x>
+                    <y>30</y>
+                    <width>200</width>
+                    <height>21</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+        </widget>
+    </widget>
+    <widget class="QGroupBox">
+        <property name="name">
+            <cstring>groupBox3</cstring>
+        </property>
+        <property name="geometry">
+            <rect>
+                <x>10</x>
+                <y>130</y>
+                <width>540</width>
+                <height>110</height>
+            </rect>
+        </property>
+        <property name="title">
+            <string>Sorting</string>
+        </property>
+        <widget class="QLabel">
+            <property name="name">
+                <cstring>textLabel1_4</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>5</x>
+                    <y>30</y>
+                    <width>40</width>
+                    <height>21</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="text">
+                <string>PCA</string>
+            </property>
+        </widget>
+        <widget class="QPushButton">
+            <property name="name">
+                <cstring>sort_button</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>410</x>
+                    <y>20</y>
+                    <width>50</width>
+                    <height>30</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="text">
+                <string>Sort</string>
+            </property>
+        </widget>
+        <widget class="QPushButton">
+            <property name="name">
+                <cstring>sort_all_button</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>470</x>
+                    <y>20</y>
+                    <width>61</width>
+                    <height>30</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="text">
+                <string>Sort all</string>
+            </property>
+        </widget>
+        <widget class="QSpinBox">
+            <property name="name">
+                <cstring>penalty_mix</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>480</x>
+                    <y>70</y>
+                    <width>40</width>
+                    <height>20</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="lineStep">
+                <number>1</number>
+            </property>
+        </widget>
+        <widget class="QLabel">
+            <property name="name">
+                <cstring>textLabel1_5_2_2</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>420</x>
+                    <y>70</y>
+                    <width>50</width>
+                    <height>21</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="text">
+                <string>Penalty</string>
+            </property>
+        </widget>
+        <widget class="QSpinBox">
+            <property name="name">
+                <cstring>prin_comp</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>370</x>
+                    <y>70</y>
+                    <width>40</width>
+                    <height>20</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+        </widget>
+        <widget class="QSpinBox">
+            <property name="name">
+                <cstring>max_clusters</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>190</x>
+                    <y>70</y>
+                    <width>40</width>
+                    <height>20</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+        </widget>
+        <widget class="QLabel">
+            <property name="name">
+                <cstring>textLabel1_5_1</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>240</x>
+                    <y>70</y>
+                    <width>123</width>
+                    <height>20</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="lineWidth">
+                <number>1</number>
+            </property>
+            <property name="midLineWidth">
+                <number>0</number>
+            </property>
+            <property name="text">
+                <string>Princ. Components</string>
+            </property>
+            <property name="scaledContents">
+                <bool>false</bool>
+            </property>
+            <property name="alignment">
+                <set>AlignBottom</set>
+            </property>
+        </widget>
+        <widget class="QSpinBox">
+            <property name="name">
+                <cstring>min_clusters</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>70</x>
+                    <y>70</y>
+                    <width>40</width>
+                    <height>20</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+        </widget>
+        <widget class="QLabel">
+            <property name="name">
+                <cstring>textLabel1_5</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>5</x>
+                    <y>70</y>
+                    <width>60</width>
+                    <height>21</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="text">
+                <string>Min clust</string>
+            </property>
+        </widget>
+        <widget class="QLabel">
+            <property name="name">
+                <cstring>textLabel1_5_2</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>120</x>
+                    <y>70</y>
+                    <width>62</width>
+                    <height>21</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="text">
+                <string>Max clust</string>
+            </property>
+        </widget>
+        <widget class="QLabel">
+            <property name="name">
+                <cstring>PCVarianceLabel</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>280</x>
+                    <y>20</y>
+                    <width>130</width>
+                    <height>30</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="lineWidth">
+                <number>1</number>
+            </property>
+            <property name="margin">
+                <number>0</number>
+            </property>
+            <property name="text">
+                <string>Variance: 0</string>
+            </property>
+            <property name="alignment">
+                <set>AlignVCenter</set>
+            </property>
+        </widget>
+        <widget class="QComboBox">
+            <item>
+                <property name="text">
+                    <string>Correlations</string>
+                </property>
+            </item>
+            <item>
+                <property name="text">
+                    <string>Variances-Covariances</string>
+                </property>
+            </item>
+            <item>
+                <property name="text">
+                    <string>Sums-Of-Squares-Cross-Products</string>
+                </property>
+            </item>
+            <property name="name">
+                <cstring>pca_method</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>40</x>
+                    <y>30</y>
+                    <width>230</width>
+                    <height>21</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+        </widget>
+    </widget>
+    <widget class="QGroupBox">
+        <property name="name">
+            <cstring>groupBox1</cstring>
+        </property>
+        <property name="geometry">
+            <rect>
+                <x>10</x>
+                <y>240</y>
+                <width>540</width>
+                <height>360</height>
+            </rect>
+        </property>
+        <property name="title">
+            <string>Data plotting</string>
+        </property>
+        <widget class="QwtSlider">
+            <property name="name">
+                <cstring>qwtSlider1_2</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>490</x>
+                    <y>23</y>
+                    <width>20</width>
+                    <height>245</height>
+                </rect>
+            </property>
+            <property name="orientation">
+                <enum>Vertical</enum>
+            </property>
+            <property name="bgStyle">
+                <enum>BgSlot</enum>
+            </property>
+            <property name="toolTip" stdset="0">
+                <string>Low threshold</string>
+            </property>
+        </widget>
+        <widget class="QwtSlider">
+            <property name="name">
+                <cstring>qwtSlider1</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>20</x>
+                    <y>23</y>
+                    <width>20</width>
+                    <height>245</height>
+                </rect>
+            </property>
+            <property name="orientation">
+                <enum>Vertical</enum>
+            </property>
+            <property name="bgStyle">
+                <enum>BgSlot</enum>
+            </property>
+            <property name="toolTip" stdset="0">
+                <string>High threshold</string>
+            </property>
+        </widget>
+        <widget class="QwtPlot">
+            <property name="name">
+                <cstring>plot</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>50</x>
+                    <y>30</y>
+                    <width>430</width>
+                    <height>280</height>
+                </rect>
+            </property>
+            <property name="frameShape">
+                <enum>NoFrame</enum>
+            </property>
+            <property name="frameShadow">
+                <enum>Plain</enum>
+            </property>
+            <property name="margin">
+                <number>0</number>
+            </property>
+            <property name="midLineWidth">
+                <number>0</number>
+            </property>
+            <property name="xBottomAxis" stdset="0">
+                <bool>true</bool>
+            </property>
+            <property name="yLeftAxis" stdset="0">
+                <bool>true</bool>
+            </property>
+            <property name="yRightAxis" stdset="0">
+                <bool>false</bool>
+            </property>
+            <property name="title">
+                <string></string>
+            </property>
+        </widget>
+        <widget class="QLabel">
+            <property name="name">
+                <cstring>timeIntervalLabel</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>290</x>
+                    <y>320</y>
+                    <width>111</width>
+                    <height>30</height>
+                </rect>
+            </property>
+            <property name="font">
+                <font>
+                </font>
+            </property>
+            <property name="text">
+                <string>Time Window:</string>
+            </property>
+        </widget>
+        <widget class="QwtWheel">
+            <property name="name">
+                <cstring>qwtWheel1</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>120</x>
+                    <y>320</y>
+                    <width>160</width>
+                    <height>30</height>
+                </rect>
+            </property>
+        </widget>
+        <widget class="QLCDNumber">
+            <property name="name">
+                <cstring>lCDNumber1</cstring>
+            </property>
+            <property name="geometry">
+                <rect>
+                    <x>410</x>
+                    <y>320</y>
+                    <width>40</width>
+                    <height>30</height>
+                </rect>
+            </property>
+            <property name="paletteForegroundColor">
+                <color>
+                    <red>191</red>
+                    <green>191</green>
+                    <blue>191</blue>
+                </color>
+            </property>
+            <property name="paletteBackgroundColor">
+                <color>
+                    <red>36</red>
+                    <green>36</green>
+                    <blue>35</blue>
+                </color>
+            </property>
+            <property name="font">
+                <font>
+                    <pointsize>10</pointsize>
+                </font>
+            </property>
+            <property name="lineWidth">
+                <number>1</number>
+            </property>
+            <property name="margin">
+                <number>-1</number>
+            </property>
+            <property name="numDigits">
+                <number>4</number>
+            </property>
+        </widget>
+    </widget>
+</widget>
+<menubar>
+    <property name="name">
+        <cstring>MenuBar</cstring>
+    </property>
+    <property name="geometry">
+        <rect>
+            <x>0</x>
+            <y>0</y>
+            <width>560</width>
+            <height>27</height>
+        </rect>
+    </property>
+    <item text="&amp;File" name="fileMenu">
+        <action name="fileOpenAction"/>
+        <action name="fileExport_as_NEVAction"/>
+        <action name="fileCloseAction"/>
+        <separator/>
+        <action name="fileOpen_a_directoryAction"/>
+        <action name="fileSort_a_directoryAction"/>
+        <separator/>
+        <action name="filePrintAction"/>
+        <separator/>
+        <action name="fileExitAction"/>
+    </item>
+    <item text="&amp;Help" name="helpMenu">
+        <action name="helpAboutAction"/>
+    </item>
+</menubar>
+<toolbars>
+</toolbars>
+<actions>
+    <action>
+        <property name="name">
+            <cstring>fileOpenAction</cstring>
+        </property>
+        <property name="iconSet">
+            <iconset></iconset>
+        </property>
+        <property name="text">
+            <string>&amp;Open file...</string>
+        </property>
+        <property name="menuText">
+            <string>&amp;Open file...</string>
+        </property>
+        <property name="toolTip">
+            <string>Open a file...</string>
+        </property>
+        <property name="accel">
+            <string>Ctrl+O</string>
+        </property>
+    </action>
+    <action>
+        <property name="name">
+            <cstring>fileExitAction</cstring>
+        </property>
+        <property name="text">
+            <string>&amp;Exit</string>
+        </property>
+        <property name="menuText">
+            <string>&amp;Exit</string>
+        </property>
+        <property name="toolTip">
+            <string>Exit</string>
+        </property>
+        <property name="accel">
+            <string></string>
+        </property>
+    </action>
+    <action>
+        <property name="name">
+            <cstring>helpAboutAction</cstring>
+        </property>
+        <property name="text">
+            <string>A&amp;bout</string>
+        </property>
+        <property name="menuText">
+            <string>A&amp;bout</string>
+        </property>
+        <property name="toolTip">
+            <string>About</string>
+        </property>
+        <property name="accel">
+            <string>F9</string>
+        </property>
+    </action>
+    <action>
+        <property name="name">
+            <cstring>fileExport_as_NEVAction</cstring>
+        </property>
+        <property name="enabled">
+            <bool>true</bool>
+        </property>
+        <property name="iconSet">
+            <iconset></iconset>
+        </property>
+        <property name="text">
+            <string>&amp;Save as NEV2...</string>
+        </property>
+        <property name="menuText">
+            <string>&amp;Save as NEV2...</string>
+        </property>
+        <property name="toolTip">
+            <string>Save as NEV2</string>
+        </property>
+        <property name="accel">
+            <string>Ctrl+S</string>
+        </property>
+    </action>
+    <action>
+        <property name="name">
+            <cstring>fileOpen_a_directoryAction</cstring>
+        </property>
+        <property name="iconSet">
+            <iconset></iconset>
+        </property>
+        <property name="text">
+            <string>Export &amp;directory...</string>
+        </property>
+        <property name="menuText">
+            <string>Export &amp;directory...</string>
+        </property>
+        <property name="toolTip">
+            <string>Export a directory...</string>
+        </property>
+        <property name="accel">
+            <string>Ctrl+D</string>
+        </property>
+    </action>
+    <action>
+        <property name="name">
+            <cstring>fileExport_as_ASCIIAction</cstring>
+        </property>
+        <property name="text">
+            <string>Export as &amp;ASCII...</string>
+        </property>
+        <property name="menuText">
+            <string>Export as &amp;ASCII...</string>
+        </property>
+        <property name="toolTip">
+            <string>Export as ASCII</string>
+        </property>
+        <property name="accel">
+            <string>Ctrl+A</string>
+        </property>
+    </action>
+    <action>
+        <property name="name">
+            <cstring>fileCloseAction</cstring>
+        </property>
+        <property name="text">
+            <string>&amp;Close</string>
+        </property>
+        <property name="menuText">
+            <string>&amp;Close</string>
+        </property>
+        <property name="toolTip">
+            <string>Close</string>
+        </property>
+        <property name="accel">
+            <string>Ctrl+W</string>
+        </property>
+    </action>
+    <action>
+        <property name="name">
+            <cstring>filePrintAction</cstring>
+        </property>
+        <property name="text">
+            <string>&amp;Print</string>
+        </property>
+        <property name="menuText">
+            <string>&amp;Print</string>
+        </property>
+        <property name="toolTip">
+            <string>Print</string>
+        </property>
+        <property name="accel">
+            <string>Ctrl+P</string>
+        </property>
+    </action>
+    <action>
+        <property name="name">
+            <cstring>Action</cstring>
+        </property>
+        <property name="iconSet">
+            <iconset></iconset>
+        </property>
+        <property name="text">
+            <string>Unnamed</string>
+        </property>
+        <property name="menuText">
+            <string>Unnamed</string>
+        </property>
+    </action>
+    <action>
+        <property name="name">
+            <cstring>fileSort_a_directoryAction</cstring>
+        </property>
+        <property name="text">
+            <string>Sort &amp;units in directory...</string>
+        </property>
+        <property name="menuText">
+            <string>Sort &amp;units in directory...</string>
+        </property>
+        <property name="toolTip">
+            <string>Sort units in directory</string>
+        </property>
+        <property name="accel">
+            <string>Ctrl+U</string>
+        </property>
+    </action>
+</actions>
+<connections>
+    <connection>
+        <sender>fileOpenAction</sender>
+        <signal>activated()</signal>
+        <receiver>main_form</receiver>
+        <slot>fileOpen()</slot>
+    </connection>
+    <connection>
+        <sender>helpAboutAction</sender>
+        <signal>activated()</signal>
+        <receiver>main_form</receiver>
+        <slot>helpAbout()</slot>
+    </connection>
+    <connection>
+        <sender>fileExitAction</sender>
+        <signal>activated()</signal>
+        <receiver>main_form</receiver>
+        <slot>fileExit()</slot>
+    </connection>
+    <connection>
+        <sender>qwtSlider1</sender>
+        <signal>valueChanged(double)</signal>
+        <receiver>main_form</receiver>
+        <slot>setHighThresold(double)</slot>
+    </connection>
+    <connection>
+        <sender>qwtSlider1_2</sender>
+        <signal>valueChanged(double)</signal>
+        <receiver>main_form</receiver>
+        <slot>setLowThresold(double)</slot>
+    </connection>
+    <connection>
+        <sender>timeBox</sender>
+        <signal>activated(const QString&amp;)</signal>
+        <receiver>main_form</receiver>
+        <slot>timeChanged(const QString&amp;)</slot>
+    </connection>
+    <connection>
+        <sender>qwtSlider1</sender>
+        <signal>sliderMoved(double)</signal>
+        <receiver>main_form</receiver>
+        <slot>replot()</slot>
+    </connection>
+    <connection>
+        <sender>qwtSlider1_2</sender>
+        <signal>sliderMoved(double)</signal>
+        <receiver>main_form</receiver>
+        <slot>replot()</slot>
+    </connection>
+    <connection>
+        <sender>fileOpen_a_directoryAction</sender>
+        <signal>activated()</signal>
+        <receiver>main_form</receiver>
+        <slot>fileExportDir()</slot>
+    </connection>
+    <connection>
+        <sender>fileCloseAction</sender>
+        <signal>activated()</signal>
+        <receiver>main_form</receiver>
+        <slot>closeFile()</slot>
+    </connection>
+    <connection>
+        <sender>fileExport_as_NEVAction</sender>
+        <signal>activated()</signal>
+        <receiver>main_form</receiver>
+        <slot>fileExportAsNEV()</slot>
+    </connection>
+    <connection>
+        <sender>fileExport_as_ASCIIAction</sender>
+        <signal>activated()</signal>
+        <receiver>main_form</receiver>
+        <slot>fileExportAsASCII()</slot>
+    </connection>
+    <connection>
+        <sender>filePrintAction</sender>
+        <signal>activated()</signal>
+        <receiver>main_form</receiver>
+        <slot>print()</slot>
+    </connection>
+    <connection>
+        <sender>unit_select</sender>
+        <signal>activated(const QString&amp;)</signal>
+        <receiver>main_form</receiver>
+        <slot>unitChanged(const QString&amp;)</slot>
+    </connection>
+    <connection>
+        <sender>sort_button</sender>
+        <signal>clicked()</signal>
+        <receiver>main_form</receiver>
+        <slot>reSort()</slot>
+    </connection>
+    <connection>
+        <sender>pca_method</sender>
+        <signal>activated(int)</signal>
+        <receiver>main_form</receiver>
+        <slot>sortMethodChanged(int)</slot>
+    </connection>
+    <connection>
+        <sender>sort_all_button</sender>
+        <signal>clicked()</signal>
+        <receiver>main_form</receiver>
+        <slot>sortAllChannels()</slot>
+    </connection>
+    <connection>
+        <sender>fileSort_a_directoryAction</sender>
+        <signal>activated()</signal>
+        <receiver>main_form</receiver>
+        <slot>fileSortDir()</slot>
+    </connection>
+    <connection>
+        <sender>min_clusters</sender>
+        <signal>valueChanged(int)</signal>
+        <receiver>main_form</receiver>
+        <slot>sortMethodChanged(int)</slot>
+    </connection>
+    <connection>
+        <sender>max_clusters</sender>
+        <signal>valueChanged(int)</signal>
+        <receiver>main_form</receiver>
+        <slot>sortMethodChanged(int)</slot>
+    </connection>
+    <connection>
+        <sender>prin_comp</sender>
+        <signal>valueChanged(int)</signal>
+        <receiver>main_form</receiver>
+        <slot>sortMethodChanged(int)</slot>
+    </connection>
+    <connection>
+        <sender>penalty_mix</sender>
+        <signal>valueChanged(int)</signal>
+        <receiver>main_form</receiver>
+        <slot>sortMethodChanged(int)</slot>
+    </connection>
+    <connection>
+        <sender>channelSelect</sender>
+        <signal>activated(int)</signal>
+        <receiver>main_form</receiver>
+        <slot>channelChanged(int)</slot>
+    </connection>
+    <connection>
+        <sender>export_as_ascii</sender>
+        <signal>clicked()</signal>
+        <receiver>main_form</receiver>
+        <slot>fileExportAsASCII()</slot>
+    </connection>
+    <connection>
+        <sender>qwtWheel1</sender>
+        <signal>valueChanged(double)</signal>
+        <receiver>main_form</receiver>
+        <slot>timeChangedWheel()</slot>
+    </connection>
+</connections>
+<includes>
+    <include location="global" impldecl="in declaration">qfiledialog.h</include>
+    <include location="global" impldecl="in declaration">qmessagebox.h</include>
+    <include location="local" impldecl="in implementation">main_form.ui.h</include>
+</includes>
+<variables>
+    <variable access="private">double *x;</variable>
+    <variable access="private">double **y;</variable>
+    <variable access="private">uchar *unit;</variable>
+    <variable access="private">long mHigh;</variable>
+    <variable access="private">long mLow;</variable>
+    <variable access="private">uint channel;</variable>
+    <variable access="private">uint events;</variable>
+    <variable access="private">long *data;</variable>
+    <variable access="private">bool *unitSelect;</variable>
+</variables>
+<slots>
+    <slot>init()</slot>
+    <slot>fileOpen()</slot>
+    <slot>fileExportAsNEV()</slot>
+    <slot>fileExportAsASCII()</slot>
+    <slot>closeFile()</slot>
+    <slot>fileExportDir()</slot>
+    <slot>fileSortDir()</slot>
+    <slot>fileExit()</slot>
+    <slot>helpAbout()</slot>
+    <slot>setHighThresold( double value )</slot>
+    <slot>setLowThresold( double value )</slot>
+    <slot>replot( const QString &amp; value )</slot>
+    <slot>timeChanged( const QString &amp; value )</slot>
+    <slot>timeChangedWheel()</slot>
+    <slot>channelChanged( int ch )</slot>
+    <slot>replot()</slot>
+    <slot>print()</slot>
+    <slot>unitChanged( const QString &amp; value )</slot>
+    <slot>addUnits()</slot>
+    <slot>reSort()</slot>
+    <slot returnType="uint">countEvents( uint ch, int fileNumber )</slot>
+    <slot>setPlot()</slot>
+    <slot returnType="int">maxSpikes()</slot>
+    <slot returnType="bool">sortAllChannels()</slot>
+    <slot>sortMethodChanged( int value )</slot>
+    <slot>closeEvent( QCloseEvent * e )</slot>
+    <slot>displaySpikes()</slot>
+</slots>
+<functions>
+    <function access="private">resetData()</function>
+    <function access="private">resetPlot()</function>
+</functions>
+<pixmapinproject/>
+<layoutdefaults spacing="6" margin="11"/>
+<includehints>
+    <includehint>qwt_slider.h</includehint>
+    <includehint>qwt_slider.h</includehint>
+    <includehint>qwt_plot.h</includehint>
+    <includehint>qwt_scale.h</includehint>
+    <includehint>qwt_scale.h</includehint>
+    <includehint>qwt_wheel.h</includehint>
+</includehints>
+</UI>
Index: gui/main_form.ui.h
===================================================================
RCS file: /cvsroot/nev2lkit/nev2lkit/gui/main_form.ui.h,v
retrieving revision 1.24
diff -B -U4 -r1.24 main_form.ui.h
--- gui/main_form.ui.h	1 Oct 2005 15:23:42 -0000	1.24
+++ gui/main_form.ui.h	7 Jun 2006 20:57:44 -0000
@@ -19,8 +19,9 @@
 
 #include "about_form.h"
 #include "ascii.h"
 #include "KlustaKwik.h"
+#include "pca.h"
 #include "labview.h"
 //#include "labview2.h"
 #include "lib.h"
 #include "nev.h"
@@ -56,13 +57,18 @@
   // Set the ranges of the sorting parameters
   max_clusters->setRange (1, MAX_POSSIBLE_CLUSTERS - 2);
   min_clusters->setRange (1, MAX_POSSIBLE_CLUSTERS - 2);
   penalty_mix->setRange (0,10);
+  prin_comp->setRange (2,PRINCIPAL_COMPONENTS);
+  
 
   // And set the initial values
   max_clusters->setValue (MAX_CLUSTERS);
   min_clusters->setValue (MIN_CLUSTERS);
   penalty_mix->setValue ((int) (PENALTY_MIX * 10));
+  prin_comp->setValue (3);
+    
+  
 
   // Set axis titles
   plot->setAxisTitle (QwtPlot::xBottom, "Time[ms]");
   plot->setAxisTitle (QwtPlot::yLeft, "Signal[mV]");
@@ -73,8 +79,9 @@
   // Disable almost all the widgets
   export_format->setCurrentItem (2);
   qwtSlider1->setEnabled (false);
   qwtSlider1_2->setEnabled (false);
+  qwtWheel1->setEnabled (false);
   channelSelect->setEnabled (false);
   timeBox->setEnabled (false);
   unit_select->setEnabled (false);
   sort_button->setEnabled (false);
@@ -652,8 +659,12 @@
 #endif
 
   resetPlot ();
   timeInterval = atof (timeBox->currentText ().ascii ());
+  qwtWheel1->setRange ((double) 1, (double) 4, (double) 0.1);
+  qwtWheel1->setValue (atof (timeBox->currentText ().ascii ()));
+//  timeIntervalLabel->setText ("Time Window: " + FloatToQString(timeInterval));
+  lCDNumber1->display (timeInterval);
   setPlot ();
 
   if (voltages != NULL)
   {
@@ -663,8 +674,35 @@
   else
     eventsLabel->setText ("Events: 0");
 }
 
+/*
+ * Name: timeChangedWheel
+ * Action: Sets the new time interval selected and replots the plotting
+ * widget
+ * Returns: Nothing
+ */
+void
+main_form::timeChangedWheel ()
+{
+
+  resetPlot ();
+    timeInterval = (float) qwtWheel1->value ();  
+//    timeIntervalLabel->setText ("Time Window: " + FloatToQString(timeInterval));
+    lCDNumber1->display (timeInterval);
+
+  setPlot ();
+
+  if (voltages != NULL)
+  {
+    channelChanged (channelSelect->currentItem ());
+    eventsLabel->setText ("Events: " + UintToQString (events));
+  }
+  else
+    eventsLabel->setText ("Events: 0");
+}
+
+
 
 /*
  * Name: channelChanged
  * Action: Plots the values of the channel selected
@@ -684,8 +722,10 @@
     if (x == NULL)
     {
       channel = ch;
       timeChanged (timeBox->currentText ());
+//      qwtWheel1->setRange ((double) 1, (double) 4, (double) 0.05);
+//      qwtWheel1->setValue (atof (timeBox->currentText ().ascii ()));
     }
     else
     {
       if (channel != (uint) ch)
@@ -777,8 +817,9 @@
       plot->setAxisScale (0, (double) minValue, (double) maxValue);
 
       qwtSlider1->setEnabled (true);
       qwtSlider1_2->setEnabled (true);
+      qwtWheel1->setEnabled (true);
       timeBox->setEnabled (true);
       unit_select->setEnabled (true);
       pca_method->setEnabled (true);
       sort_button->setEnabled (true);
@@ -798,8 +839,9 @@
   else
   {
     qwtSlider1->setEnabled (false);
     qwtSlider1_2->setEnabled (false);
+    qwtWheel1->setEnabled (false);
     timeBox->setEnabled (false);
     unit_select->setEnabled (false);
     sort_button->setEnabled (false);
     plot->setEnabled (false);
@@ -961,8 +1003,10 @@
   qwtSlider1->setValue (qwtSlider1->minValue ());
   qwtSlider1_2->setValue (qwtSlider1_2->minValue ());
   qwtSlider1->setEnabled (false);
   qwtSlider1_2->setEnabled (false);
+  qwtWheel1->setValue (atof (timeBox->currentText ().ascii ()));
+  qwtWheel1->setEnabled (false);
   channelSelect->setEnabled (false);
   timeBox->setEnabled (false);
   unit_select->setEnabled (false);
   sort_button->setEnabled (false);
@@ -1180,8 +1224,10 @@
 
     logFile.open (LOG_FILE_NAME, ios::out);
     SortSpikes (channelSelect->currentItem () - 1);
     logFile.close ();
+    PCVarianceLabel->setText ("Variance: " + UintToQString (pcvar) + "%" );  
+    
     channelChanged (channelSelect->currentItem ());
 
     if (progress != NULL)
     {
@@ -1336,9 +1382,11 @@
   for (uint i = 0; i < activeChannels && !canceled; i++)
     canceled = !SortSpikes (i);
 
   logFile.close ();
-  
+
+  PCVarianceLabel->setText ("Variance: " + UintToQString (pcvar) + "%" );  
+
   if (!canceled)
     channelChanged (channelSelect->currentItem ());
 
   if (progress != NULL && erase)
@@ -1366,8 +1414,12 @@
   sortMethod = pca_method->currentItem ();
   MinClusters = atoi (min_clusters->text ());
   MaxClusters = MaxPossibleClusters = atoi (max_clusters->text ()) + 1;
   PenaltyMix = atof (penalty_mix->text ()) / 10.0;
+  PrinComp = atoi (prin_comp->text ());
+
+    
+    
 
   if (MinClusters > (MaxClusters - 1))
   {
     QMessageBox::warning (this, APP_NAME, "Min clusters can't be higher than Max clusters!");
@@ -1402,9 +1454,10 @@
 void
 main_form::displaySpikes ()
 {
   bool canceled = false, erase = false;
-
+  uint counter=0;
+  
   if (progress == NULL)
   {
     erase = true;
     progress = new QProgressDialog (this, APP_NAME, true);
@@ -1429,8 +1482,9 @@
   for (uint i = 0; i < events && !canceled; i++)
   {
     if (unitSelect[(uint) unit[i]])
     {
+      counter++;
       data[i] = plot->insertCurve (UintToQString (i));
       switch ((uint) unit[i])
       {
         case 1: // Noise
@@ -1497,8 +1551,10 @@
       }
     }
   }
 
+  eventsLabel->setText ("Events: " + UintToQString (counter));
+    
   if (canceled)
   {
     if (data != NULL)
     {
Index: include/nev2lkit.h
===================================================================
RCS file: /cvsroot/nev2lkit/nev2lkit/include/nev2lkit.h,v
retrieving revision 1.18
diff -B -U4 -r1.18 nev2lkit.h
--- include/nev2lkit.h	1 Oct 2005 15:23:42 -0000	1.18
+++ include/nev2lkit.h	7 Jun 2006 20:58:15 -0000
@@ -58,9 +58,9 @@
 #define UPDATE_FREQUENCY        1000
 #define EXTENDED_FORMAT	        0
 #define SHORT_FORMAT	        1
 #define SHORT_WAVE_FORMAT       2
-#define PRINCIPAL_COMPONENTS	3
+#define PRINCIPAL_COMPONENTS	7
 #define SORT_CORRELATIONS       0
 #define SORT_COVARIANCES        1
 #define SORT_SSCP               2
 #define LOG_FILE_NAME           "sort.log"
Index: include/pca.h
===================================================================
RCS file: /cvsroot/nev2lkit/nev2lkit/include/pca.h,v
retrieving revision 1.1.1.1
diff -B -U4 -r1.1.1.1 pca.h
--- include/pca.h	16 Sep 2004 19:31:31 -0000	1.1.1.1
+++ include/pca.h	7 Jun 2006 20:58:15 -0000
@@ -38,5 +38,10 @@
 void free_matrix (float **, int);
 void tred2 (float **, int, float *, float *);
 bool tqli (float [], float [], int, float **);
 
+
+// external parameters
+extern uint PrinComp;
+extern uint pcvar;
+
 #endif
Index: lib/KK.cpp
===================================================================
RCS file: /cvsroot/nev2lkit/nev2lkit/lib/KK.cpp,v
retrieving revision 1.9
diff -B -U4 -r1.9 KK.cpp
--- lib/KK.cpp	19 Oct 2004 19:13:32 -0000	1.9
+++ lib/KK.cpp	7 Jun 2006 20:58:15 -0000
@@ -23,8 +23,9 @@
 #include "KK.h"
 #include "KlustaKwik.h"
 #include "KlustaSave.h"
 #include "lib.h"
+#include "pca.h"
 
 
 // Sets storage for KK class.  Needs to have nDims and nPoints defined
 void
@@ -123,9 +124,9 @@
     }
   }
 
   if (usingComponents)
-    nDims = nFeatures = PRINCIPAL_COMPONENTS;
+    nDims = nFeatures = PrinComp;
   else
     nDims = nFeatures = bytesPerWaveForm;
 
   // We use all the columns
@@ -146,8 +147,9 @@
     {
       for (j = 0; j < nDims;)
         Data[h++] = pca[i][j++];
     }
+  logFile << "Size of 'Data' is  " << h << "." << endl;
   }
   else
   {
     for (f = 0, h = 0; f < openedFiles; f++)
Index: lib/lib.cpp
===================================================================
RCS file: /cvsroot/nev2lkit/nev2lkit/lib/lib.cpp,v
retrieving revision 1.20
diff -B -U4 -r1.20 lib.cpp
--- lib/lib.cpp	1 Oct 2005 15:23:42 -0000	1.20
+++ lib/lib.cpp	7 Jun 2006 20:58:17 -0000
@@ -633,10 +633,13 @@
     number.append (UintToQString ((uint) n));
     n -= (uint) n;
     number.append (".");
 
-    while (n - (uint) n > 0)
+    while (n - (uint) n > 0){
       n *= 10;
+      if (n>1000)
+      	break;
+    }  
     number.append (UintToQString ((uint) n));
   }
 
   return number;
Index: lib/pca.cpp
===================================================================
RCS file: /cvsroot/nev2lkit/nev2lkit/lib/pca.cpp,v
retrieving revision 1.7
diff -B -U4 -r1.7 pca.cpp
--- lib/pca.cpp	12 Oct 2004 21:13:42 -0000	1.7
+++ lib/pca.cpp	7 Jun 2006 20:58:18 -0000
@@ -41,16 +41,21 @@
 #include "lib.h"
 #include "nev2lkit.h"
 #include "pca.h"
 
+uint PrinComp = PRINCIPAL_COMPONENTS;
+uint pcvar;
 
 bool
 PCA ()
 {
+
   int h;
-  uint n, m, i, j, k, k2, l;
+  uint n, m, i, j, k, k2, l; 
+  float VARIANCE,PCVariance;
+  
   bool usingComponents;
-  float **data, **symmat, **symmat2, *evals, *interm;
+  float **data, **symmat, *evals, *interm;
 
   for (n = 0, h = 0; h < openedFiles; h++)
     n += mainForm->countEvents (Channel + 1, h);
 
@@ -122,25 +127,29 @@
 
   /* Allocate storage for dummy and new vectors. */
   evals = vec (m);
   interm = vec (m);
-  symmat2 = matrix (m, m);
 
-  for (i = 1; i <= m; i++)
-  {
-    for (j = 1; j <= m; j++) 
-      symmat2[i][j] = symmat[i][j];
-  }
   tred2 (symmat, m, evals, interm);
   if ((usingComponents = tqli (evals, interm, m, symmat)) == true)
   {
-    /* Form projections of row-points on first three prin. components.
+    /* Form projections of row-points on first 'PRINCIPAL_COMPONENTS' prin. components.
        Store in 'data', overwriting original data. */
+  VARIANCE = 0.;
+  PCVariance = 0.;
+  for (j = m; j >=1; j--) {
+    VARIANCE+=evals[j];
+  }
+  for (j = m; j >= m-PrinComp+1; j--) {
+    PCVariance+=100*evals[j]/VARIANCE;
+  }
+  pcvar=uint(PCVariance);  
+
     for (i = 1; i <= n; i++)
     {
       for (j = 1; j <= m; j++)
         interm[j] = data[i][j];
-      for (k = 1; k <= 3; k++)
+      for (k = 1; k <= PRINCIPAL_COMPONENTS; k++)
       {
         data[i][k] = 0.0;
         for (k2 = 1; k2 <= m; k2++)
           data[i][k] += interm[k2] * symmat[k2][m - k + 1];
@@ -149,18 +158,19 @@
 
     pca = new float *[n];
     for (i = 0; i < n; i++)
     {
-      pca[i] = new float [PRINCIPAL_COMPONENTS];
-      for (j = 0; j < PRINCIPAL_COMPONENTS; j++)
+      pca[i] = new float [PrinComp];
+      for (j = 0; j < PrinComp; j++)
+        pca[i][j] = 0.0;
+      for (j = 0; j < PrinComp; j++)
         pca[i][j] = data[i + 1][j + 1];
     }
   }
 
   // Delete the matrix and vectors used
   free_matrix (data, n);
   free_matrix (symmat, m);
-  free_matrix (symmat2, m);
   free_vector (evals);
   free_vector (interm);
 
   return usingComponents;
@@ -192,10 +202,9 @@
   for (j = 1; j <= m; j++)
   {
     stddev[j] = 0.0;
     for (i = 1; i <= n; i++)
-      stddev[j] += (   ( data[i][j] - mean[j] ) *
-                         ( data[i][j] - mean[j] )  );
+      stddev[j] += (   ( data[i][j] - mean[j] ) * ( data[i][j] - mean[j] )  );
     stddev[j] /= (float)n;
     stddev[j] = sqrt(stddev[j]);
 
     /* The following in an inelegant but usual way to handle
@@ -454,12 +463,12 @@
         if (fabs(e[m]) + dd == dd) break;
       }
       if (m != l)
       {
-        if (iter++ == 30)
+        if (iter++ == 100)
  	{
-          //QMessageBox::warning (mainForm, APP_NAME, "Warning. Theres no convergence between the values. Sorting could be incorrect!");
-	  return false;
+         QMessageBox::warning (mainForm, APP_NAME, "Warning. Theres no convergence between the values. Sorting could be incorrect!");
+//	  return false;
 	}
 
         g = (d[l+1] - d[l]) / (2.0 * e[l]);
         r = sqrt((g * g) + 1.0);
